name: Release on Tag

on:
  push:
    tags:
      - '*'  # ç›‘å¬æ‰€æœ‰æ ‡ç­¾

jobs:
  release:
    name: Create Release
    runs-on: ubuntu-latest
    permissions:
      contents: write  # èµ‹äºˆ GitHub Token å†™å…¥ Release æƒé™

    steps:
      - name: æ£€å‡ºä»“åº“ä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½®ç‰ˆæœ¬å˜é‡
        run: echo "TAG_NAME=${GITHUB_REF#refs/tags/}" >> $GITHUB_ENV

      - name: æ‰“åŒ…å¤šä¸ªæ–‡ä»¶å’Œæ–‡ä»¶å¤¹
        run: |
          zip -r COM3D2_Scripts_901-${{ env.TAG_NAME }}.zip \
            scripts/ \
            README.md \
            -x "folder2/exclude-this-file.txt"

      - name: ç”Ÿæˆæ›´æ–°æ—¥å¿—
        id: changelog
        uses: mikepenz/release-changelog-builder-action@v4
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: åˆ›å»º Release å¹¶ä¸Šä¼ èµ„æº
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ env.TAG_NAME }}
          name: Release ${{ env.TAG_NAME }}
          body: |
            ## ğŸš€ ç‰ˆæœ¬ï¼š${{ env.TAG_NAME }}
            
            ### ğŸ“ æ›´æ”¹
            ${{ steps.changelog.outputs.changelog }}
            
            ---
            
            *æ­¤ç‰ˆæœ¬ç”± GitHub Actions è‡ªåŠ¨ç”Ÿæˆ*
          draft: false
          prerelease: false
          files: COM3D2_Scripts_901-${{ env.TAG_NAME }}.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
